# Система управления правами доступа

## Обзор

В проект добавлена комплексная система управления правами доступа, которая позволяет тонко настраивать доступ пользователей к различным функциям системы.

## Структура системы

### Типы прав

1. **PAGE_ACCESS** - Доступ к страницам
2. **ACTION** - Конкретные действия (создание, редактирование, удаление)
3. **FEATURE** - Дополнительный функционал

### Ресурсы

Система покрывает все основные страницы и функции:

#### Страницы
- DASHBOARD - Главная страница
- REQUESTS - Заявки
- CLIENTS - Клиенты
- ACCOUNTING - Бухгалтерия
- ANALYTICS - Аналитика
- REPORTS - Отчеты
- SETTINGS - Настройки
- SLA - SLA мониторинг

#### Подстраницы бухгалтерии
- ACCOUNTS - Счета
- CURRENCIES - Валюты
- DEPOSITS - Депозиты
- EXCHANGE_RATES - Курсы валют
- OPERATIONS - Операции

#### Действия
- CREATE_* - Создание сущностей
- EDIT_* - Редактирование
- DELETE_* - Удаление
- MANAGE_* - Управление
- VIEW_REPORTS - Просмотр отчетов
- EXPORT_REPORTS - Экспорт отчетов

#### Функционал
- BULK_OPERATIONS - Массовые операции
- ADVANCED_SEARCH - Расширенный поиск
- AUDIT_LOGS - Логи аудита

## API Endpoints

### Управление правами
- `GET /api/admin/permissions` - Список всех прав
- `POST /api/admin/permissions` - Создание нового права
- `GET /api/admin/permissions/[id]` - Получение права по ID
- `PATCH /api/admin/permissions/[id]` - Обновление права
- `DELETE /api/admin/permissions/[id]` - Удаление права

### Управление правами ролей
- `GET /api/admin/role-permissions` - Получение прав ролей
- `POST /api/admin/role-permissions` - Назначение права роли
- `PUT /api/admin/role-permissions` - Массовое обновление прав роли

## Админ панель

В админ панели добавлен новый таб "Права" с двумя основными разделами:

### 1. Права доступа по ролям
- Выбор роли (Администратор/Кассир)
- Визуальное отображение прав по категориям
- Возможность включать/отключать права для роли
- Группировка по типам прав

### 2. Управление правами
- Список всех прав в системе
- Создание новых прав
- Просмотр статуса и описания прав

## Настройка по умолчанию

### Права администратора
Администратор по умолчанию имеет все права в системе.

### Права кассира
Кассир имеет ограниченный набор прав:
- Доступ к основным рабочим страницам
- Возможность работы с заявками и клиентами
- Базовые операции бухгалтерии
- Просмотр отчетов
- Исключены: создание пользователей, системные настройки, удаление данных

## Заполнение базовых данных

Для заполнения системы базовыми правами используйте:

```bash
# Запуск скрипта заполнения прав
npx tsx prisma/seed-permissions.ts
```

Скрипт создаст:
- 30+ базовых прав доступа
- Назначит все права администратору
- Назначит ограниченные права кассиру

## База данных

### Таблицы

1. **permissions** - Определения прав
   - id, name, description, type, resource, conditions, isActive

2. **role_permissions** - Связи между ролями и правами
   - id, role, permissionId, restrictions, isActive

### Связи
- Права связаны с ролями через промежуточную таблицу
- Поддержка дополнительных ограничений на уровне роли
- Возможность деактивации прав без удаления

## Безопасность

- Все API endpoints защищены аутентификацией
- Доступ к управлению правами только у администраторов
- Валидация данных через Zod схемы
- Проверка существования прав перед назначением

## Расширение системы

Для добавления новых прав:

1. Добавьте новый ResourceType в Prisma схему
2. Обновите Zod схемы в `src/lib/types.ts`
3. Добавьте описание в `resourceLabels` в PermissionsTab
4. Создайте право через API или админ панель
5. Назначьте право нужным ролям
